<section class="productos">
  <header class="productos__header">
    <h1>Gestión de productos</h1>
    <button type="button" class="btn" (click)="prepararCreacion()">Nuevo producto</button>
  </header>

  <article class="card">
    <form #productoForm="ngForm" (ngSubmit)="guardar()" novalidate>
      <h2>{{ form.id ? 'Editar producto' : 'Alta de producto' }}</h2>

      <div class="form-group">
        <label for="nombre">Nombre *</label>
        <input
          id="nombre"
          name="name"
          type="text"
          required
          [(ngModel)]="form.name"
        />
        <small class="error" *ngIf="productoForm.submitted && !form.name.trim()">El nombre es obligatorio.</small>
      </div>

      <div class="form-group">
        <label for="codigo">Código AFIP</label>
        <input
          id="codigo"
          name="afip_code"
          type="text"
          maxlength="20"
          [(ngModel)]="form.afip_code"
        />
      </div>

      <div class="form-group">
        <label for="tarifa">Tarifa base *</label>
        <input
          id="tarifa"
          name="default_tariff"
          type="number"
          min="0"
          step="0.01"
          required
          [(ngModel)]="form.default_tariff"
        />
        <small class="error" *ngIf="productoForm.submitted && (form.default_tariff === null || form.default_tariff < 0)">
          La tarifa base debe ser un número igual o mayor a cero.
        </small>
      </div>

      <div class="acciones">
        <button type="submit" class="btn btn--primary">{{ form.id ? 'Guardar cambios' : 'Crear producto' }}</button>
        <button type="button" class="btn btn--secondary" *ngIf="form.id" (click)="cancelarEdicion()">Cancelar</button>
      </div>

      <p class="feedback feedback--error" *ngIf="error">{{ error }}</p>
      <p class="feedback feedback--success" *ngIf="success">{{ success }}</p>
    </form>
  </article>

  <article class="card">
    <h2>Productos registrados</h2>

    <div *ngIf="loading" class="placeholder">Cargando productos...</div>
    <div *ngIf="!loading && productos.length === 0" class="placeholder">Aún no hay productos registrados.</div>

    <table *ngIf="!loading && productos.length > 0">
      <thead>
        <tr>
          <th>Nombre</th>
          <th>Código AFIP</th>
          <th>Tarifa base</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let producto of productos">
          <td>{{ producto.name }}</td>
          <td>{{ producto.afip_code || '—' }}</td>
          <td>{{ producto.default_tariff | number: '1.2-2' }}</td>
          <td class="acciones">
            <button type="button" class="btn btn--link" (click)="editar(producto)">Editar</button>
          </td>
        </tr>
      </tbody>
    </table>
  </article>
</section>
